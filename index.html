<!DOCTYPE html>
<html>
<head>
<base href="">
  <title>Blocks demo</title>
  <meta charset="utf-8">
  <style type="text/css">
    html, body {
      padding: 0;
      margin: 0;
      font-family: "Helvetica Neue", sans-serif;
      font-size: 24px;
      line-height: 1.5em;
      height: 100%;
    }

    .container {
      display: table;
      height: 100%;
    }

    .profile {
      width: 1px;
    }

    .profile div {
      transition: visibility 0s 0.2s, width 0.5s;
    }

    .hidden div {
      visibility: hidden;
      width: 0;
      transition: visibility 0s 0.1s, width 0.5s;
    }

    .demo, .profile {
      vertical-align: top;
      display: table-cell;
    }

    .demo {
      width: 100%;
      height: 100%;
    }

    .demo__content {
      padding: 0 32px;
      font-size: 13px;
    }

    .demo__header {
      margin: 16px 0 8px 0;
      font-size: 16px;
      font-weight: normal;
    }

    .demo__query-example {
      width: 100%; margin: auto;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="dist/ring-lib.css">
  <link rel="icon" type="image/x-icon" href="site/favicon.ico">

  <script src="components/jquery/jquery.js"></script>
  <script src="components/requirejs/require.js"></script>
  <script src="bundles/ring.config.js"></script>

  <script>
    require([
      'jquery',
      'ring',
      'auth/auth',
      'header/header__hub-services',
      'header/header__userinfo',
      'query-assist/query-assist',
      'profile/profile',
      'json'],
      function($, ring) {
      window.ring = ring;

      var authData = {
        serverUri: "***REMOVED***/",
        refresh: true
      };

      var o = ring();

      ring('menu')('init', {
        "type": ["gradient", "4x"],
        "left": {
          "projects": {
            "toggle": {
              "items": [
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "label": "test hover",
                  "url": "/rest/agile",
                  "event": {
                    "type": "hover",
                    "name":  "dropdown:hover"
                  },
                  "action": true
                },
                {
                  "label": "test click",
                  "url": "/rest/agile",
                  "event": {
                    name: "dropdown:click",
                    data: 'Clicked!'
                  },
                  "action": true
                },
                {
                  "label": "two events",
                  "url": "/rest/agile",
                  "event": [{
                              "name":  "dropdown:hover",
                              "type": "hover"
                            },{
                              name: "dropdown:click",
                              data: 'Clicked!'
                            }],
                  "action": true
                },
                {
                  "label": "dependent",
                  "url": "/rest/agile",
                  "action": true
                }
              ]
            },
            "active": 1,
              "url": "/projects",
              "event": {
              "name": "menu:test",
                "data": "projects"
            },
            "label": "Projects"
          },
          "agents": {
            "counter": {
              "color": "red",
                "label": 125
            },
            "label": "Agents",
              "url": "/rest/reports",
              "event": {
              "name": "menu:test",
                "data": "agents"
            },
            "toggle": {
              "items": [
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "separator": true
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "label": "Agile Board",
                  "url": "/rest/agile"
                }
              ]
            }
          },
          "logo": {
            "order": 1,
              "image": "site/ring.png",
              "url": "/dashboard",
              "items": [
  //                  {
  //                    "className": "test-class",
  //                    "label": "Issues",
  //                    "title": "Tilte attribute content",
  //                    "url": "/issues"
  //                  },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "image": "site/ring.png",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              }
            ]
          },
          "button": {
            "type": "button",
            "button": [
              {
                "label": "Add something",
                "className": "ring-btn_primary demo__select-example"
              },
              {
                "className": "ring-btn_primary ring-btn_icon ring-btn__dropdown-icon ring-menu__item_noselect",
                "type": "caret-down",
                dropdown: {
                  items: [
                    {
                      label: 'Hello world'
                    }
                  ]
                }
              }
            ]
          },
          "toggle-profile": {}
        },
        "right": {
          "search": {
            "type": "search",
              "url": "/search"
          },
          "cog": {
            "type": "cog",
              "url": "/prefs",
              "event": {
              "name": "menu:test",
                "data": "right.cog"
            }
          },
          "help": {
            "type": "help",
              "url": "/help",
              "items": [
              {
                "className": "test-class",
                "label": "Issues",
                "title": "Tilte attribute content",
                "url": "/issues"
              },
              {
                "label": "Agile Board",
                "url": "/rest/agile"
              }
            ]
          }
        }
      }, '.demo', 'prepend');

      o('init', {
        header: {
          "type": "4x",
          "authLinks": {
            "login": {
              "label": "Log in",
              "event": "header:login"
            }
          }
        },
        profile: {
          targetElem: '.profile'
        }
      });

      ring('footer')('init', {
        type: '4x',
        left: [
          [{url: 'http://www.jetbrains.com/teamcity/?fromServer', label: 'TeamCity'}, 'by JetBrains'],
          'Enterprise 8.0.2 EAP (build 27448)'
        ],
        center: [
          [{copyright: 2000, label: ' JetBrains'}, {middot: 1}, 'All rights reserved'],
          {url: 'http://teamcity.jetbrains.com/showAgreement.html', label: 'License agreement', title: 'READ ME!'}
        ],
        right: [
          {url: 'http://www.jetbrains.com/teamcity/feedback?source=footer&version=8.0.3%20(build%2027531)&build=27531&mode=ent', label: 'Feedback'}
        ]
      }, '.demo', 'append');

      o.on('menu:toggle-profile', function() {
        $('.profile').toggleClass('hidden');
      });

      o.on('dropdown:test', function (e) {
        console.log(arguments);
        return false;
      });

      var auth = ring('auth');

      o.on('header:login', function() {
        auth('init', authData);
      });

      o.on('auth:init:done', function() {
        ring('menu')('update', 'left.toggle-profile', {
          "type": "button",
          "button": {
            "label": "Services profiles",
            "event": "menu:toggle-profile"
          }
        });
      });

      auth('init', $.extend({
        denyIA: true,
        refresh: true
      }, authData));

      o.on('menu:test', function(data) {
        ring('menu', 'setActive')(data);
        return false;
      });

      o.on('dropdown:hover', function() {
        ring('alerts')('add', 'Ho-ho-hover', 'success', true, 10000);
      });

      o.on('dropdown:click', function(message,e) {
        ring('alerts')('add', message, 'success', true, 10000);
        return false;
      });

      // todo(igor.alexeenko): More impressive demo. Show all possibilities.
      ring('alerts').invoke('add', 'Alerts demo. Will hide in 10 secs.',
          'success', true, 10000);

      var select = ring('dropdown-select');
      select('init', {
          targetElem: '.demo__select-example',
          dataSource: select('remoteDataSource', {
              add: {
                  title:'Add to',
                  callback: function() {
                      console.log(arguments);
                  },
                  url:'api/rest/usergroups?fields=id,name,iconUrl,total'
              },
              remove: {
                  title: 'Remove from',
                  url:'api/rest/users/#{userId}?fields=groups(id,name,iconUrl)',
                  callback: function() {
                      console.log(arguments);
                  }
              }
          })
      });

      var query = ring('query-assist');

      if (auth('getToken', true)) {
        query('init', {
          targetElem: '.demo__query-example',
          query: 'name: admin or id: 1',
          dataSource: query('remoteDataSource', {
            url: 'api/rest/users/queryAssist?caret=#{caret}&fields=query,caret,suggestions#{styleRanges}&query=#{query}'
          })
        });
      };

      query.on('apply', function() {
        ring('alerts', 'add')('Query submitted','success', true, 10000);
      });

      ring('shortcuts')('bind', {
        key: 'space',
        handler: function() {
          ring('alerts', 'add')('Shortcuts!','success', true, 10000);
        }
      });
    });
  </script>
</head>
<body>
<div class="container">
  <div class="profile hidden"></div>
  <div class="demo">
    <div class="demo__content">
      <h2 class="demo__header">Docs</h2>

      <div><a class="ring-link" href="dist/docs/API.html">View API documentation</a></div>
      <div><a class="ring-link" href="dist/styleguide/">CSS Styleguide</a></div>
      <div class="demo__query-example"></div>
    </div>
  </div>
</div>

</body>
</html>
