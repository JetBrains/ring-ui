<!DOCTYPE html>
<html>
<head>
<base href="">
  <title>Blocks demo</title>
  <meta charset="utf-8">
  <style type="text/css">
    html, body {
      padding: 0;
      margin: 0;
      font-family: "Helvetica Neue", sans-serif;
      font-size: 24px;
      line-height: 1.5em;
      height: 100%;
    }

    .demo {
      width: 100%;
      height: 100%;
    }

    .demo__profile {
      float: left;
      margin: 0 24px;
    }

    .demo__content {
      padding: 0 32px;
      font-size: 13px;
    }

    .demo__header {
      margin: 16px 0 8px 0;
      font-size: 16px;
      font-weight: normal;
    }

    .demo__query-example {
      width: 100%; margin: auto;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="dist/ring-lib.css">
  <link rel="icon" type="image/x-icon" href="site/favicon.ico">

  <script src="components/jquery/dist/jquery.js"></script>
  <script src="components/requirejs/require.js"></script>
  <script src="bundles/ring.config.js"></script>

  <script>
    require([
      'jquery',
      'ring',
      'auth/auth',
      'header/header__hub-services',
      'header/header__userinfo',
      'query-assist/query-assist',
      'profile/profile',
      'json',
        'dropdown-menu/dropdown-menu',
        'action-list/action-list',
        'delayed-listener/delayed-listener',
        'dropdown-select/dropdown-select',
        'dropdown-filter/dropdown-filter'
      ],
      function($, ring) {
      window.ring = ring;

      var authData = {
        serverUri: "***REMOVED***/",
        refresh: true
      };

      var o = ring();

      ring('menu')('init', {
        "type": ["gradient", "4x"],
        "left": {
          "projects": {
            "toggle": {
              "items": [
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "label": "test hover",
                  "url": "/rest/agile",
                  "event": {
                    "type": "hover",
                    "name":  "dropdown:hover"
                  },
                  "action": true
                },
                {
                  "label": "test click",
                  "url": "/rest/agile",
                  "event": {
                    name: "dropdown:click",
                    data: 'Clicked!'
                  },
                  "action": true
                },
                {
                  "label": "two events",
                  "url": "/rest/agile",
                  "event": [{
                    "name":  "dropdown:hover",
                    "type": "hover"
                  },{
                    name: "dropdown:click",
                    data: 'Clicked!'
                  }],
                  "action": true
                },
                {
                  "label": "dependent",
                  "url": "/rest/agile",
                  "action": true
                }
              ]
            },
            "active": 1,
              "url": "/projects",
              "event": {
              "name": "menu:test",
                "data": "projects"
            },
            "label": "Projects"
          },
          "agents": {
            "counter": {
              "color": "red",
                "label": 125
            },
            "label": "Agents",
              "url": "/rest/reports",
              "event": {
              "name": "menu:test",
                "data": "agents"
            },
            "toggle": {
              "items": [
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "separator": true
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "className": "test-class",
                  "label": "Issues",
                  "title": "Tilte attribute content",
                  "url": "/issues"
                },
                {
                  "label": "Agile Board",
                  "url": "/rest/agile"
                }
              ]
            }
          },
          "logo": {
            "order": 1,
            "image": "site/ring.png",
            "url": "/dashboard",
            "items": [
              {
                "className": "test-class",
                "label": "Issues",
                "title": "Tilte attribute content",
                "url": "/issues"
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "image": "site/ring.png",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              },
              {
                "label": "dependent",
                "url": "/rest/agile",
                "action": true
              }
            ]
          },
          "button": [{
            "type": "button",
            "button": [
              {
                "label": "Add something",
                "className": "ring-btn_primary ring-js-shortcuts",
                "action-list": {
                  type: [
                    'typed'
                  ],
                  description: "Place here any text",
                  "items": [
                    {
                      "type": "service",
                      "label": "test1"
                    },
                    {
                      "type": "service",
                      "label": "test2"
                    },
                    {
                      "type": "service",
                      "label": "test3"
                    },
                    {
                      "type": "service",
                      "label": "test4"
                    }
                  ]
                }
              },
              {
                "className": "ring-btn_primary ring-btn_icon ring-btn__dropdown-icon ring-menu__item_noselect ring-js-dropdown-menu",
                "type": "caret-down",
                "dropdown-menu": {
                  "items":[
                    {
                      "label": "test"
                    },
                    {
                      "label": "test2"
                    }]
                }
              },
              {
                "label": "User select",
                "className": "ring-btn_primary ring-js-filter ring-js-shortcuts"
              }
            ]
          }],
          "toggle-profile": {}
        },
        "right": {
          "search": {
            "type": "search",
            "className": "delayed-listener-demo",
            "url": "/search"
          },
          "cog": {
            "type": "cog",
              "url": "/prefs",
              "event": {
              "name": "menu:test",
                "data": "right.cog"
            }
          },
          "help": {
            "type": "help",
              "url": "/help",
              "items": [
              {
                "className": "test-class",
                "label": "Issues",
                "title": "Tilte attribute content",
                "url": "/issues"
              },
              {
                "label": "Agile Board",
                "url": "/rest/agile"
              }
            ]
          }
        }
      }, '.demo', 'prepend');

      o('init', {
        header: {
          "type": "4x",
          "authLinks": {
            "login": {
              "label": "Log in",
              "event": "header:login"
            }
          }
        }
      });

      ring('footer')('init', {
        type: '4x',
        left: [
          [{url: 'http://www.jetbrains.com/teamcity/?fromServer', label: 'TeamCity'}, 'by JetBrains'],
          'Enterprise 8.0.2 EAP (build 27448)'
        ],
        center: [
          [{copyright: 2000, label: ' JetBrains'}, {middot: 1}, 'All rights reserved'],
          {url: 'http://teamcity.jetbrains.com/showAgreement.html', label: 'License agreement', title: 'READ ME!'}
        ],
        right: [
          {url: 'http://www.jetbrains.com/teamcity/feedback?source=footer&version=8.0.3%20(build%2027531)&build=27531&mode=ent', label: 'Feedback'}
        ]
      }, '.demo', 'append');

      o.on('menu:toggle-profile', function() {
        if (!$('.ring-profile').length) {
          ring('profile').invoke('init', {targetElem: '.demo__profile'});
        } else {
          $('.demo__profile').toggle();
        }
      });

      o.on('dropdown:test', function (e) {
        console.log(arguments);
        return false;
      });

      var auth = ring('auth');

      o.on('header:login', function() {
        auth('init', authData);
      });

      o.on('auth:init:done', function() {
        ring('menu')('update', 'left.toggle-profile', {
          "type": "button",
          "button": {
            "label": "Services profiles",
            "event": "menu:toggle-profile"
          }
        });
      });

      auth('init', $.extend({
        denyIA: true,
        refresh: true
      }, authData));

      o.on('menu:test', function(data) {
        ring('menu', 'setActive')(data);
        return false;
      });

      o.on('dropdown:hover', function() {
        ring('alerts')('add', 'Ho-ho-hover', 'success', true, 10000);
      });

      o.on('dropdown:click', function(message,e) {
        ring('alerts')('add', message, 'success', true, 10000);
        return false;
      });

        var filter = ring('dropdown-filter');
        filter('init', {
          target: '.ring-js-filter',
          actions: [
            {
              type: 'add',
              title: 'Add to',
              change: function () {
                console.log(arguments);
              },
              dataSource: filter('remoteDataSource', {
                hubResource:'usergroups',
                url: 'api/rest/usergroups?fields=id,name,iconUrl,total'
              })
            },
            {
              type: 'remove',
              title: 'Remove from',
              dataSource: filter('remoteDataSource', {
                hubResource:'groups',
                url: 'api/rest/users/#{userId}/groups?'
              }),
              change: function () {
                console.log(arguments);
              }
            }
          ]
        });

        var query = ring('query-assist');

        query('init', {
          targetElem: '.demo__query-example',
          query: 'name: admin or id: 1',
          dataSource: query('remoteDataSource', {
            url: 'api/rest/users/queryAssist?caret=#{caret}&fields=query,caret,suggestions#{styleRanges}&query=#{query}'
          })
        });

        query.on('apply', function () {
          ring('alerts', 'add')('Query submitted', 'success', true, 10000);
        });

      ring('shortcuts')('bind', {
        key: 'ctrl',
        handler: function() {
          ring('alerts', 'add')('Shortcuts!','success', true, 10000);
        }
      });


          var select = ring('dropdown-select');

          select('init', {
              target: '.select-demo',
              onChange: function (data) {
                  $(this.target).val(data.label);
              },
              onShow: function () {
                  console.log('onShow', arguments);
              },
              onHide: function () {
                  console.log('onHide', arguments);
              },
              dataSource: select('remoteDataSource', {
                  hubResource: 'usergroups',
                  url: 'api/rest/usergroups?fields=id,name,iconUrl,total&query=#{query}'
              })
          });

    });
  </script>
</head>
<body>
<div class="container">
  <div class="demo">
    <div class="demo__profile"></div>
    <div class="demo__content">
      <h2 class="demo__header">Docs</h2>

      <div><a class="ring-link" href="dist/docs/API.html">View API documentation</a></div>
      <div><a class="ring-link" href="dist/styleguide/">CSS Styleguide</a></div>
      <div class="demo__query-example"></div>
        <div class="ring-input_wrapper">
            <input class="ring-input ring-js-shortcuts select-demo">
        </div>
    </div>
  </div>
</div>

</body>
</html>
