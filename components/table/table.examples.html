<example name="Table">
  <file type="html">
    <div id="demo"></div>
  </file>
  <file type="js">
    import React, {Component, createElement} from 'react';
    import {render} from 'react-dom';
    import Table from './table';
    import Selection from './selection';
    import Link from '../link/link';
    import Pager from '../pager/pager';
    import Button from '../button/button';
    import mock from './table.examples.json';

    const pageSize = 7;
    const total = mock.length;

    class Example extends Component {
      state = {
        data: [],
        selection: new Selection(),
        caption: undefined,
        selectable: true,
        total,
        page: 1,
        pageSize,
        pageTotal: Math.ceil(total / pageSize),
        sortKey: 'country',
        sortOrder: true
      }

      columns = [
        {
          id: 'country',
          title: 'Country',
          sortable: true
        },
        {
          id: 'city',
          title: 'City',
          sortable: true
        },
        {
          id: 'url',
          title: 'URL',
          getValue: ({url}) => <Link href={url}>{url}</Link>
        }
      ]

      onSort = ({column: {id: sortKey}, order: sortOrder}) => {
        this.setState({sortKey, sortOrder});
      }

      onPageChange = ({page}) => {
        this.setState({page});
      }

      componentWillMount() {
        this.loadPage();
      }

      componentDidUpdate(prevProps, prevState) {
        const {page, sortKey, sortOrder} = this.state;
        if (page !== prevState.page || sortKey !== prevState.sortKey || sortOrder !== prevState.sortOrder) {
          this.loadPage();
        }
      }

      loadPage = () => {
        const {page, pageSize, sortKey, sortOrder} = this.state;

        let data = [...mock];
        data.sort((a, b) => a[sortKey].localeCompare(b[sortKey]) * (sortOrder ? 1 : -1));
        data = data.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize);

        const selection = new Selection({data});

        this.setState({data, selection});
      }

      render() {
        const {data, caption, selectable, page, pageTotal, selection, sortKey, sortOrder} = this.state;

        return (
          <div>
            <Table
              data={data}
              columns={this.columns}
              selection={selection}
              onSelect={selection => this.setState({selection})}
              onSort={this.onSort}
              sortKey={sortKey}
              sortOrder={sortOrder}
              caption={caption}
              selectable={selectable}
              autofocus={true}
            />

            <Pager total={pageTotal} current={page} onPageChange={this.onPageChange} />

            <p>Active items: {[...selection.getActive()].map(item => item.country).join(', ')}</p>

            <p>
              {
                selectable
                ? <Button onClick={() => this.setState({selectable: false})}>Non-selectable</Button>
                : <Button onClick={() => this.setState({selectable: true})}>Selectable</Button>
              }
              {" "}
              {
                caption
                ? <Button onClick={() => this.setState({caption: undefined})}>Without a caption</Button>
                : <Button onClick={() => this.setState({caption: 'Countries'})}>With a caption</Button>
              }
            </p>

            <p>
              {
                selection.isSelected(data[3])
                ? <Button onClick={() => this.setState({selection: selection.deselect(data[3])})}>Deselect {data[3].country}</Button>
                : <Button onClick={() => this.setState({selection: selection.select(data[3])})}>Select {data[3].country}</Button>
              }
              {" "}
              {
                selection.isSelected(data[5])
                ? <Button onClick={() => this.setState({selection: selection.deselect(data[5])})}>Deselect {data[5].country}</Button>
                : <Button onClick={() => this.setState({selection: selection.select(data[5])})}>Select {data[5].country}</Button>
              }
            </p>
          </div>
        );
      }
    }

    render(createElement(Example, {}), document.getElementById('demo'));
  </file>
</example>

<example name="MultiTable">
  <file type="html">
    <div id="demo"></div>
  </file>
  <file type="js">
    import React, {Component, createElement} from 'react';
    import {render} from 'react-dom';
    import MultiTable from './multitable';
    import Table from './table';
    import mock from './table.examples2.json';

    class Example extends Component {
      columns1 = [
        {
          id: 'continent',
          title: 'Continent'
        },
        {
          id: 'url',
          title: 'URL'
        }
      ]

      columns2 = [
        {
          id: 'country',
          title: 'Country'
        },
        {
          id: 'city',
          title: 'City'
        },
        {
          id: 'url',
          title: 'URL'
        }
      ]

      render() {
        return (
          <MultiTable>
            <Table data={mock.continents} columns={this.columns1} caption="Continents" />
            <Table data={mock.countries} columns={this.columns2} caption="Countries" autofocus={true} />
          </MultiTable>
        );
      }
    }

    render(createElement(Example, {}), document.getElementById('demo'));
  </file>
</example>
