var exec = require('child_process').exec;
var params = {cwd: '{{escapeBackslashes gruntfileDirectory}}'};
var command = '{{escapeBackslashes command}}{{#if task}} {{escapeBackslashes task}}{{/if}}{{#if args}} {{{escapeBackslashes args}}}{{/if}}';

exec('git diff --cached --name-only', params, function (error, stdout, stderr) {
  if (error){
    process.exit(-1);
  } else {
    var files = (stdout || '').split('\n').filter(function(filename) {
      return (/\.js$/).test(filename);
    });

    if (files.length === 0) {
      process.exit(0);
    }

    process.env.HOOK_FILES = files.join('\n');

    exec(command, params, function (err, stdout, stderr) {
        console.log(stdout);

        var exitCode = 0;
        if (err) {
          console.log(stderr);
          exitCode = -1;
        }{{#unless preventExit}}

        process.exit(exitCode);{{/unless}}
    });
  }
});