<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="dist/ring-tree.css">

  <script src="components/jquery/jquery.js"></script>
  <script src="components/requirejs/require.js"></script>
  <script src="bundles/ring.config.js"></script>
</head>
<body>
  <script type="text/javascript">
    require(['ring', 'tree/tree'], function (ring) {
      var files = [
        { path: 'webui/scripts/views/list_view1.coffee', isSelected: true },
        { path: 'config.js', isSelected: true },
        { path: 'webui/scripts/views/list_view2.coffee', isSelected: true },
        { path: 'webui/styles/main.scss', isSelected: true }
      ];

      var Tree = ring('tree').invoke('getTree'),
          tree1 = new Tree(files, {
            onRender: updateState,
            onFileClick: function ($el) {},
            onDirClick: function ($el) {}
          });
          tree2 = new Tree(),
          tree3 = new Tree(null, {
            message: 'Custom message for empty tree'
          });

      tree1.$containerEl.on('click', '.ring-tree__item-dirCheckbox', function (e) {
        e.stopPropagation();
        var state = e.target.checked,
            items = tree1.getDirItems($(e.target.parentNode));

        items.each(function (i, item) {
          item.isSelected = state;
          // var id = el.getAttribute('id'),
          //     model = collection.get(id);
          // model.set('isSelected', state);
        });
        tree1.refresh(items);
      });

      tree1.$containerEl.on('click', '.ring-tree__item-fileCheckbox', function (e) {
        e.stopPropagation();

        var state = e.target.checked,
            el = e.target.parentNode,
            item = $(el).data('item').value;

        item.isSelected = state;
        tree1.refresh(item);

        // var state = e.target.checked,
        //     id = e.target.parentNode.getAttribute('id'),
        //     model = collection.get('id');

        // model.set('isSelected', state);
      });

      function updateState(treeInstance) {
        var $dirChbxEls = treeInstance.$containerEl.find('.ring-tree__item-dirCheckbox');
        $dirChbxEls.each(function (i, el) {
          var selectedItems = [],
              $items = treeInstance.getDirItems($(el).parent());

          $items.each(function (i, item) {
            if (item.isSelected) { selectedItems.push(item); }
          });

          el.checked = selectedItems.length === $items.length;
        });
      }

      document.body.appendChild(tree1.render()[0]);

      setTimeout(function () {
        tree1.add([
          { path: 'webui/styles/base.scss', isSelected: true }
        ]);

        setTimeout(function () {
          tree1.remove([
            { path: 'webui/styles/main.scss' },
            { path: 'webui/styles/base.scss' }
          ]);

          setTimeout(function () {
            tree1.add([
              { path: 'webui/styles/new/main.scss', isSelected: false }
            ]);
          }, 2000);

        }, 2000);

      }, 2000);

      document.body.appendChild(tree2.render()[0]);
      document.body.appendChild(tree3.render()[0]);
    });
  </script>
</body>
</html>